<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kolam Aplikasi - Halo KAKA</title>
    
    <!-- Memuat Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Memuat Google Font (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        // Konfigurasi Tailwind untuk menambahkan warna custom
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'accent': '#3486d9',
                        'accent-dark': '#2a6bb0',
                        'accent-light': '#EBF4FF',
                    },
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Animasi smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* CSS untuk Modal (diperlukan untuk SEMUA modal) */
        .modal {
            display: none; /* Sembunyi secara default */
            transition: opacity 0.3s ease;
        }
        .modal.flex {
            display: flex; /* Ditampilkan oleh JS */
        }
        
        /* CSS untuk Hamburger (diperlukan untuk header.html) */
        #menu-toggle {
            display: none;
        }
        #menu-toggle:checked + label + #mobile-menu {
            display: block;
        }
        
        /* CSS untuk Loading Spinner (khusus halaman ini) */
        #loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3486d9;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="font-sans text-gray-800 bg-gray-50">

    <!-- 1. HEADER (Placeholder) -->
    <!-- Kode header.html akan dimuat oleh js/main.js ke sini -->
    <div id="header-placeholder">
        <header class="bg-white shadow-sm sticky top-0 z-50">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <div class="text-3xl font-bold text-accent">Halo KAKA</div>
                <div class="h-6 w-24 bg-gray-200 rounded animate-pulse"></div>
            </nav>
        </header>
    </div>

    <!-- Main Content: Kolam Aplikasi (Konten unik halaman ini) -->
    <main class="container mx-auto px-6 py-12 min-h-screen">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">Kolam Aplikasi</h1>
        <p class="text-lg text-gray-600 mb-8">Temukan semua aplikasi terdaftar yang siap menunjang kinerja Anda.</p>

        <!-- Kontrol: Pencarian dan Filter -->
        <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Pencarian -->
                <div class="md:col-span-4">
                    <label for="search-input" class="block text-sm font-medium text-gray-700 mb-1">Cari Aplikasi (Nama, Kategori, Developer)</label>
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Ketik nama aplikasi, kategori, atau developer..." class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent">
                        <span class="absolute right-4 top-3.5 text-gray-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </span>
                    </div>
                </div>
                <!-- Filter -->
                <div class="">
                    <label for="filter-kategori" class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                    <select id="filter-kategori" class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-accent">
                        <option value="">Semua Kategori</option>
                    </select>
                </div>
                <div>
                    <label for="filter-developer" class="block text-sm font-medium text-gray-700 mb-1">Developer</label>
                    <select id="filter-developer" class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-accent">
                        <option value="">Semua Developer</option>
                    </select>
                </div>
                <div>
                    <label for="filter-tahun" class="block text-sm font-medium text-gray-700 mb-1">Tahun</label>
                    <select id="filter-tahun" class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-accent">
                        <option value="">Semua Tahun</option>
                    </select>
                </div>
                <div>
                    <label for="filter-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                    <select id="filter-status" class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-accent">
                        <option value="">Semua Status</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Kontrol Tampilan (Grid/List) -->
        <div class="flex justify-end items-center mb-4">
            <span class="text-sm text-gray-600 mr-3">Tampilan:</span>
            <button id="view-grid" class="p-2 rounded-lg bg-accent-light text-accent mr-2">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
            </button>
            <button id="view-list" class="p-2 rounded-lg bg-gray-200 text-gray-600">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
            </button>
        </div>

        <!-- Kontainer Aplikasi (Grid/List) -->
        <div id="loading-container" class="flex justify-center items-center py-16">
            <div id="loading-spinner"></div>
            <p class="ml-4 text-gray-600">Memuat data aplikasi...</p>
        </div>
        <div id="error-container" class="hidden text-center py-16">
            <p class="text-xl text-red-600 font-semibold">Gagal Memuat Aplikasi!</p>
            <p class="text-gray-600 mt-2">Tidak dapat terhubung ke server. Pastikan server backend Anda (npm run dev) sudah berjalan dan coba refresh halaman ini.</p>
        </div>
        <div id="aplikasi-container" class="hidden">
            <!-- Konten diisi oleh JS -->
        </div>
        <p id="no-results" class="hidden text-center text-gray-500 py-12">Tidak ada aplikasi yang ditemukan.</p>
    </main>

    <!-- Modal Detail Aplikasi (Spesifik halaman ini) -->
    <div id="modal-detail" class="modal fixed inset-0 z-50 overflow-auto bg-black bg-opacity-60 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Header Modal -->
            <div class="flex justify-between items-center p-5 border-b">
                <h3 class="text-2xl font-semibold text-gray-800" id="modal-nama">Nama Aplikasi</h3>
                <!-- Menggunakan fungsi closeModal() global dari main.js -->
                <button onclick="closeModal('modal-detail')" class="text-gray-400 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <!-- Body Modal -->
            <div class="p-6 md:p-8 overflow-y-auto">
                <div class="flex flex-col md:flex-row gap-6 md:gap-8">
                    <div class="flex-shrink-0 w-32 h-32 md:w-40 md:h-40 bg-accent-light rounded-lg flex items-center justify-center text-gray-500 overflow-hidden mx-auto md:mx-0" id="modal-logo"></div>
                    <div class="flex-grow">
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="block text-gray-500 font-medium">Kategori</span><span class="block text-gray-800 font-semibold" id="modal-kategori">-</span></div>
                            <div><span class="block text-gray-500 font-medium">Developer</span><span class="block text-gray-800 font-semibold" id="modal-developer">-</span></div>
                            <div><span class="block text-gray-500 font-medium">Tahun Buat</span><span class="block text-gray-800 font-semibold" id="modal-tahun">-</span></div>
                            <div><span class="block text-gray-500 font-medium">Status</span><span class="block text-gray-800 font-semibold" id="modal-status">-</span></div>
                            <div><span class="block text-gray-500 font-medium">Narahubung</span><span class="block text-gray-800 font-semibold" id="modal-narahubung">-</span></div>
                            <div><span class="block text-gray-500 font-medium">Total Pengunjung</span><span class="block text-gray-800 font-semibold" id="modal-pengunjung">-</span></div>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-2">Penjelasan Aplikasi</h4>
                    <p class="text-gray-600 leading-relaxed" id="modal-penjelasan">-</p>
                </div>
            </div>
            <!-- Modal Footer -->
            <div class="flex flex-col-reverse sm:flex-row justify-between items-center p-5 bg-gray-50 border-t">
                <!-- Menggunakan fungsi openModal() global dari main.js -->
                <button onclick="openModal('modal-lapor')" class="w-full sm:w-auto mt-2 sm:mt-0 text-sm text-red-600 hover:text-red-800 transition duration-300">
                    Lapor Aplikasi Bermasalah
                </button>
                <a id="modal-link" href="#" target="_blank" class="w-full sm:w-auto bg-gradient-to-r from-accent to-accent-dark text-white px-8 py-3 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition duration-300 text-center font-semibold">
                    BUKA APLIKASI
                </a>
            </div>
        </div>
    </div>

    <!-- Modal Lapor Aplikasi (Spesifik halaman ini) -->
    <div id="modal-lapor" class="modal fixed inset-0 z-50 overflow-auto bg-black bg-opacity-60 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg">
            <div class="flex justify-between items-center p-5 border-b">
                <h3 class="text-xl font-semibold text-gray-800">Lapor Aplikasi Bermasalah</h3>
                <button onclick="closeModal('modal-lapor')" class="text-gray-400 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <form id="form-laporan" class="p-6 space-y-4">
                <input type="hidden" id="report-id-app">
                <input type="hidden" id="report-nama-app">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Aplikasi yang Dilaporkan:</label>
                    <p class="text-lg font-semibold text-accent" id="report-nama-display">-</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Kategori Laporan:</label>
                    <div class="space-y-2">
                        <label class="flex items-center"><input type="checkbox" name="kategori-laporan" value="Error" class="rounded text-accent focus:ring-accent"><span class="ml-2 text-gray-700">Aplikasi Error / Bug</span></label>
                        <label class="flex items-center"><input type="checkbox" name="kategori-laporan" value="Tidak Dapat di Akses" class="rounded text-accent focus:ring-accent"><span class="ml-2 text-gray-700">Tidak Dapat di Akses (Link Mati)</span></label>
                        <label class="flex items-center"><input type="checkbox" name="kategori-laporan" value="Inactive" class="rounded text-accent focus:ring-accent"><span class="ml-2 text-gray-700">Aplikasi Sudah Tidak Digunakan (Inactive)</span></label>
                        <label class="flex items-center"><input type="checkbox" name="kategori-laporan" value="Lainnya" class="rounded text-accent focus:ring-accent"><span class="ml-2 text-gray-700">Lainnya...</span></label>
                    </div>
                </div>
                <div>
                    <label for="report-keterangan" class="block text-sm font-medium text-gray-700">Keterangan Laporan</label>
                    <textarea id="report-keterangan" rows="3" class="mt-1 w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Jelaskan masalah yang Anda temui..."></textarea>
                </div>
                <div>
                    <label for="report-nama-pelapor" class="block text-sm font-medium text-gray-700">Nama Anda</label>
                    <input type="text" id="report-nama-pelapor" required class="mt-1 w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Masukkan nama Anda...">
                </div>
                <p id="report-success" class="hidden text-sm text-green-600">Laporan berhasil terkirim. Terima kasih!</p>
                <p id="report-error" class="hidden text-sm text-red-600">Gagal mengirim laporan. Coba lagi nanti.</p>
                <div class="flex justify-end pt-4">
                    <button type="button" onclick="closeModal('modal-lapor')" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg mr-3 hover:bg-gray-300 transition duration-300">Batal</button>
                    <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition duration-300">Kirim Laporan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 5. FOOTER (Placeholder) -->
    <div id="footer-placeholder">
        <footer class="bg-gray-900 text-gray-300 pt-20 pb-10">
            <div class="container mx-auto px-6 text-center">Memuat footer...</div>
        </footer>
    </div>
    
    <!-- 6. MODALS (Placeholder) -->
    <!-- Kode modal login & lupa password akan dimuat oleh js/main.js ke sini -->
    <div id="modals-placeholder"></div>
    
    <!-- 7. SCRIPT -->
    <!-- Memuat Skrip Injeksi Komponen yang BARU -->
    <script src="js/main.js" defer></script>

    <!-- Skrip Khusus Halaman Ini -->
    <script>
        /**
         * Fungsi ini akan dipanggil oleh main.js SETELAH
         * semua komponen (header, footer, modals) dimuat.
         */
        function attachPageSpecificListeners() {
            // --- State Global (Spesifik Halaman) ---
            let aplikasiDatabase = []; // Akan diisi oleh API
            let filteredAplikasi = [];
            let currentView = 'grid'; // 'grid' atau 'list'

            // --- Elemen DOM (Spesifik Halaman) ---
            const container = document.getElementById('aplikasi-container');
            const searchInput = document.getElementById('search-input');
            const filterKategori = document.getElementById('filter-kategori');
            const filterDeveloper = document.getElementById('filter-developer');
            const filterTahun = document.getElementById('filter-tahun');
            const filterStatus = document.getElementById('filter-status');
            const noResults = document.getElementById('no-results');
            const viewGridBtn = document.getElementById('view-grid');
            const viewListBtn = document.getElementById('view-list');
            const loadingContainer = document.getElementById('loading-container');
            const errorContainer = document.getElementById('error-container');

            // --- Fungsi Render Tampilan ---
            function renderAplikasi(aplikasiArray, view) {
                if (!container) return; // Guard clause
                container.innerHTML = ''; 
                
                if (aplikasiArray.length === 0) {
                    noResults.style.display = 'block';
                    container.style.display = 'none';
                    return;
                }
                
                noResults.style.display = 'none';
                container.style.display = 'grid'; 
                
                if (view === 'grid') {
                    container.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';
                    aplikasiArray.forEach(app => { container.innerHTML += renderGrid(app); });
                } else {
                    container.className = 'bg-white shadow-lg rounded-xl overflow-hidden border border-gray-200';
                    aplikasiArray.forEach(app => { container.innerHTML += renderList(app); });
                }
            }

            function renderGrid(app) {
                const logoHtml = (app.logo && app.logo.startsWith('<svg')) ? app.logo 
                    : (app.logo ? `<img src="${app.logo}" alt="${app.nama}" class="w-full h-full object-cover">` 
                    : `<svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17.11l4.42-4.42a1 1 0 000-1.41l-4.42-4.42m6.34 8.84l4.42-4.42a1 1 0 000-1.41l-4.42-4.42"></path></svg>`);
                
                return `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-1 cursor-pointer border border-gray-100" onclick="openDetailModal(${app.id_app})">
                        <div class="h-40 bg-accent-light flex items-center justify-center text-gray-400 overflow-hidden">
                            ${logoHtml}
                        </div>
                        <div class="p-5">
                            <h3 class="text-xl font-semibold text-gray-800 mb-1 truncate" title="${app.nama}">${app.nama}</h3>
                            <span class="text-sm text-accent mb-3 block">${app.kategori}</span>
                            <div class="flex justify-between items-center">
                                <span class="text-xs font-medium text-gray-600 truncate" title="${app.developer}">${app.developer}</span>
                                <span class="text-xs px-3 py-1 rounded-full ${app.status_aplikasi === 'Aktif' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                    ${app.status_aplikasi}
                                </span>
                            </div>
                        </div>
                    </div>`;
            }

            function renderList(app) {
                const logoHtml = (app.logo && app.logo.startsWith('<svg')) ? app.logo 
                    : (app.logo ? `<img src="${app.logo}" alt="${app.nama}" class="w-full h-full object-cover">` 
                    : `<svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17.11l4.42-4.42a1 1 0 000-1.41l-4.42-4.42m6.34 8.84l4.42-4.42a1 1 0 000-1.41l-4.42-4.42"></path></svg>`);

                return `
                    <div class="flex items-center p-4 border-b border-gray-200 last:border-b-0 hover:bg-gray-50 transition duration-200 cursor-pointer" onclick="openDetailModal(${app.id_app})">
                        <div class="flex-shrink-0 w-12 h-12 bg-accent-light rounded-lg flex items-center justify-center text-gray-400 overflow-hidden">
                            ${logoHtml}
                        </div>
                        <div class="flex-grow mx-4">
                            <h3 class="text-lg font-semibold text-gray-800">${app.nama}</h3>
                            <p class="text-sm text-gray-500">${app.kategori} | ${app.developer}</p>
                        </div>
                        <div class="flex-shrink-0 flex items-center space-x-4">
                            <span class="text-sm px-3 py-1 rounded-full ${app.status_aplikasi === 'Aktif' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                ${app.status_aplikasi}
                            </span>
                            <a href="${app.link}" target="_blank" onclick="(e) => e.stopPropagation()" class="hidden md:inline-block bg-gradient-to-r from-accent to-accent-dark text-white px-5 py-2 rounded-full text-sm font-medium shadow-lg hover:shadow-xl transition duration-300">
                                Open
                            </a>
                            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                    </div>`;
            }

            // --- Fungsi Filter dan Pencarian ---
            function applyFilters() {
                const query = searchInput.value.toLowerCase();
                const kategoriFilter = filterKategori.value;
                const developerFilter = filterDeveloper.value;
                const tahunFilter = filterTahun.value;
                const statusFilter = filterStatus.value;

                filteredAplikasi = aplikasiDatabase.filter(app => {
                    const matchesQuery = (app.nama && app.nama.toLowerCase().includes(query)) ||
                                         (app.kategori && app.kategori.toLowerCase().includes(query)) ||
                                         (app.developer && app.developer.toLowerCase().includes(query));
                    
                    const matchesKategori = !kategoriFilter || app.kategori === kategoriFilter;
                    const matchesDeveloper = !developerFilter || app.developer === developerFilter;
                    const matchesTahun = !tahunFilter || app.tahun_buat == tahunFilter;
                    const matchesStatus = !statusFilter || app.status_aplikasi === statusFilter;
                    
                    return matchesQuery && matchesKategori && matchesDeveloper && matchesTahun && matchesStatus;
                });
                renderAplikasi(filteredAplikasi, currentView);
            }

            // --- Fungsi Inisialisasi ---
            function populateFilters(aplikasiArray) {
                const kategoriSet = new Set(aplikasiArray.map(app => app.kategori).filter(Boolean));
                const developerSet = new Set(aplikasiArray.map(app => app.developer).filter(Boolean));
                const tahunSet = new Set(aplikasiArray.map(app => app.tahun_buat).filter(Boolean));
                const statusSet = new Set(aplikasiArray.map(app => app.status_aplikasi).filter(Boolean));

                filterKategori.innerHTML = '<option value="">Semua Kategori</option>';
                filterDeveloper.innerHTML = '<option value="">Semua Developer</option>';
                filterTahun.innerHTML = '<option value="">Semua Tahun</option>';
                filterStatus.innerHTML = '<option value="">Semua Status</option>';

                kategoriSet.forEach(item => { filterKategori.innerHTML += `<option value="${item}">${item}</option>`; });
                developerSet.forEach(item => { filterDeveloper.innerHTML += `<option value="${item}">${item}</option>`; });
                Array.from(tahunSet).sort((a, b) => b - a).forEach(item => { filterTahun.innerHTML += `<option value="${item}">${item}</option>`; });
                statusSet.forEach(item => { filterStatus.innerHTML += `<option value="${item}">${item}</option>`; });
            }
            
            // --- Fungsi Logika Modal (Spesifik Halaman) ---
            
            // Definisikan 'openDetailModal' secara global agar bisa diakses onclick
            // Kita harus menempelkannya ke 'window' karena skrip ini ada di dalam fungsi
            window.openDetailModal = function(id) {
                const app = aplikasiDatabase.find(app => app.id_app == id);
                if (!app) return;

                const logoHtml = (app.logo && app.logo.startsWith('<svg')) ? app.logo 
                    : (app.logo ? `<img src="${app.logo}" alt="${app.nama}" class="w-full h-full object-cover">` 
                    : `<svg class="w-24 h-24 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17.11l4.42-4.42a1 1 0 000-1.41l-4.42-4.42m6.34 8.84l4.42-4.42a1 1 0 000-1.41l-4.42-4.42"></path></svg>`);
                
                document.getElementById('modal-logo').innerHTML = logoHtml;
                document.getElementById('modal-nama').innerText = app.nama;
                document.getElementById('modal-kategori').innerText = app.kategori || '-';
                document.getElementById('modal-developer').innerText = app.developer || '-';
                document.getElementById('modal-tahun').innerText = app.tahun_buat || '-';
                document.getElementById('modal-status').innerText = app.status_aplikasi || '-';
                document.getElementById('modal-narahubung').innerText = app.narahubung || '-';
                document.getElementById('modal-pengunjung').innerText = app.jumlah_pengunjung || '0';
                document.getElementById('modal-penjelasan').innerText = app.penjelasan || 'Tidak ada penjelasan.';
                document.getElementById('modal-link').href = app.link;

                document.getElementById('report-id-app').value = app.id_app;
                document.getElementById('report-nama-app').value = app.nama;
                document.getElementById('report-nama-display').innerText = app.nama;
                
                // Gunakan fungsi modal global dari main.js
                openModal('modal-detail');
            };

            // --- Event Listener Utama (diekseskusi oleh main.js) ---
            
            // 1. Ambil Data
            (async function loadAplikasi() {
                try {
                    loadingContainer.style.display = 'flex';
                    errorContainer.style.display = 'none';
                    container.style.display = 'none';

                    const response = await fetch('http://localhost:5000/api/aplikasi');
                    
                    if (!response.ok) {
                        throw new Error(`Gagal mengambil data: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    
                    aplikasiDatabase = data;
                    filteredAplikasi = data;
                    
                    loadingContainer.style.display = 'none';

                    populateFilters(aplikasiDatabase);

                    const urlParams = new URLSearchParams(window.location.search);
                    const searchQuery = urlParams.get('search');
                    
                    if (searchQuery) {
                        searchInput.value = searchQuery; 
                        applyFilters(); 
                    } else {
                        renderAplikasi(aplikasiDatabase, currentView); 
                    }

                } catch (error) {
                    console.error('Gagal memuat aplikasi:', error);
                    loadingContainer.style.display = 'none';
                    errorContainer.style.display = 'block';
                }
            })();


            // 2. Pasang Listener Filter/Search
            let searchTimeout;
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(applyFilters, 300); 
            });

            filterKategori.addEventListener('change', applyFilters);
            filterDeveloper.addEventListener('change', applyFilters);
            filterTahun.addEventListener('change', applyFilters);
            filterStatus.addEventListener('change', applyFilters);

            // 3. Pasang Listener Tombol View
            viewGridBtn.addEventListener('click', () => {
                currentView = 'grid';
                viewGridBtn.classList.add('bg-accent-light', 'text-accent');
                viewGridBtn.classList.remove('bg-gray-200', 'text-gray-600');
                viewListBtn.classList.add('bg-gray-200', 'text-gray-600');
                viewListBtn.classList.remove('bg-accent-light', 'text-accent');
                renderAplikasi(filteredAplikasi, currentView);
            });

            viewListBtn.addEventListener('click', () => {
                currentView = 'list';
                viewListBtn.classList.add('bg-accent-light', 'text-accent');
                viewListBtn.classList.remove('bg-gray-200', 'text-gray-600');
                viewGridBtn.classList.add('bg-gray-200', 'text-gray-600');
                viewGridBtn.classList.remove('bg-accent-light', 'text-accent');
                renderAplikasi(filteredAplikasi, currentView);
            });

            // 4. Pasang Listener Form Laporan
            document.getElementById('form-laporan').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const checkedKategori = [];
                document.querySelectorAll('input[name="kategori-laporan"]:checked').forEach(cb => {
                    checkedKategori.push(cb.value);
                });
                
                const data = {
                    id_app: document.getElementById('report-id-app').value,
                    nama_aplikasi: document.getElementById('report-nama-app').value,
                    jenis_laporan: checkedKategori.join(', '), 
                    keterangan: document.getElementById('report-keterangan').value,
                    nama_pelapor: document.getElementById('report-nama-pelapor').value,
                };

                const successMsg = document.getElementById('report-success');
                const errorMsg = document.getElementById('report-error');
                successMsg.style.display = 'none';
                errorMsg.style.display = 'none';

                try {
                    const response = await fetch('http://localhost:5000/api/laporan', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data),
                    });

                    if (response.ok) {
                        successMsg.style.display = 'block';
                        this.reset();
                        setTimeout(() => closeModal('modal-lapor'), 2500);
                    } else {
                        errorMsg.innerText = 'Gagal mengirim laporan. Coba lagi nanti.';
                        errorMsg.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error submitting report:', error);
                    errorMsg.innerText = 'Tidak dapat terhubung ke server. Pastikan backend berjalan.';
                    errorMsg.style.display = 'block';
                }
            });
            
        } // --- Akhir dari attachPageSpecificListeners ---
    </script>

</body>
</html>